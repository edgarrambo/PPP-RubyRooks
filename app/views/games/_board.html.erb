<% 8.times do |y| %>
      <div class="row justify-content-center">
        <% 8.times do |x| %>
          <% piece = get_piece(x, y, @game) %>
            <div id="<%= x %>,<%= y %>" data-x-coord=<%= x %> data-y-coord=<%= y %> class="<%= black_tile?(x,y) ? "black tile" : "white tile" %>">
              <% if piece.present? %>
                  <%= image_tag piece.piece_number.to_s + ".png", class: "piece", data: {piece_id: piece.id, x_coord: piece.x_position, y_coord: piece.y_position} %>
              <% end %>
            </div>
        <% end %>
      </div>
    <% end %>

<script>
  $(function() {
    $('.piece').draggable({
      containment: ".gameboard",
      snap: ".tile",
      cursor: "move"
    });
    $( '.tile').droppable({
      drop: function( event, ui ) {
        var piece = ui.draggable
        var destination_square = $(this);
        var update_piece = {
          id: piece.data('piece-id'), 
          x_position: destination_square.data('x-coord'),
          y_position: destination_square.data('y-coord'),
        }
        $.ajax({
          type: 'PATCH',
          url: '/pieces/' + update_piece.id,
          beforeSend: function(xhr) {
            xhr.setRequestHeader('X-CSRF-Token', $('meta[name="csrf-token"]').attr('content'))
          },
          dataType: 'json',
          data: {
            piece: {
              id: update_piece.id,
              x_position: update_piece.x_position,
              y_position: update_piece.y_position,
            }
          },
          error: function(xhr) {
            location.reload();
          },

          success: function(data) {
            destination_square.empty();
            location.reload(true);
          }       
        });
      }
    });
  });  
</script>
